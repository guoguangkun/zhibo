##4.3.1.2 Zookeeper简介  
要想管理好我们自己的分布式系统，就不能不提到大名鼎鼎的分布式协调框架Zookeeper。  
ZooKeeper是一个开源的分布式协调服务，由雅虎创建，是Google Chubby的开源实现。分布式应用程序可以基于ZooKeeper实现诸如数据发布/订阅、负载均衡、命名服务、分布式协调/通知、集群管理、Master选举、分布式锁和分布式队列等功能。

Zookeeper是一个开源的针对大型分布式系统的可靠协调系统，其设计目标是将复杂且容易出错的分布式一致性服务封装起来，构成一个高效可靠的原语集，并以简单易用的接口提供给用户使用。它提供的功能包括：发布/订阅，分布式协调/通知，配置管理，集群管理，主从协调，分布式锁等。
####1 为什么选择Zookeeper  
大部分分布式系统都需要一个主控、协调器或控制器来管理物理分布的子进程（如资源、任务分配等）。如果每一个系统都开发私有的协调程序，这样会造成反复编写的浪费，且难以形成通用的、伸缩性好的协调器。ZooKeeper是Google的Chubby一个开源实现，是Hadoop的分布式协调服务。它高效、可靠地解决数据一致性问题，在工业界大型分布式系统中已经得到了广泛的使用和认可。同时，作为一个框架，zookeeper是轻量级的，无论是部署还是调用都非常简单易用。
让我们来看看Zookeeper的一些特性。
#### 最终一致性  
这是Zookeeper最重要的特性，最终一致性是C和A的折中方案。当客户端发起写请求，该请求会在Zookeeper集群中所有机器上执行，当有超过一半的机器执行完成，Zookeeper即向客户端返回写入成功。因此，通常我们在部署Zookeeper集群时一般部署奇数台。
#### 顺序性  
从同一个客户端发起的事务请求，最终会严格按照其发送顺序被应用到Zookeeper中。每个事务都会被分配一个事务ID，该ID由Zookeeper统一管理，全局唯一，且递增。每个事务按照ID顺序保存在事务队列中。
#### 可靠性  
一旦Zookeeper成功的应用一事务，并完成了客户端的响应，那么该事务所引起的服务端状态变更将会被一直保留下去。
#### 实时性  
因为采用最终一致性，Zookeeper不能保证客户端能得到刚更新的数据。如果需要最新数据，可以在读取数据之前调用sync()接口。  
#### 原子性  
类似于数据库事务操作，一次数据更新要么成功，要么失败  
#### 单一视图  
无论客户端连接到哪个服务器，看到的数据模型都是一致的。也就是，同一客户端无论什么时候连接到哪个服务器上，都不会看到比自己之前看到的数据更早版本的数据。单一视图保证是由ZooKeeper客户端与服务端建立连接请求时的一些校验操作实现的。还记得刚才说的事务ID吗，这个ID会保存在服务器和客户端中。当服务器发现客户端的事务ID高于自己时，会拒绝客户端连接。客户端会自动寻找其他的Zookeeper服务器连接。

####2 Zookeeper架构及原理  
先来看看Zookeeper的整体架构，如图4-14。  
![](/assets/Zookeeper架构.png)
图4-14  
下面我们依据架构图介绍一下Zookeeper的几个核心概念，这些概念有助于读者更深入的了解Zookeeper。  
#### 角色



